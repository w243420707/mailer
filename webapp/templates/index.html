<!doctype html>
<html lang="zh-cn">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Mailer UI</title>
    <link rel="stylesheet" href="/static/styles.css?v=20251117" />
  </head>
  <body>
    <div class="container">
      <div class="header">
        <div>
          <div class="title">Mailer UI</div>
          <div class="subtitle">配置·粘贴收件人·后台发送·进度跟踪</div>
        </div>
        <div class="toolbar">
          <button id="refresh" class="btn btn-ghost" type="button">刷新配置</button>
          <button id="save" class="btn btn-primary" type="button">保存配置</button>
          <small id="saveMsg" class="muted"></small>
        </div>
      </div>

      <div class="layout-grid">
        <!-- 左列：配置 + 粘贴发送 -->
        <div class="stack">
          <div class="card" id="card-config">
            <h3>基本配置</h3>
            <section>
              <div class="row">
                <label class="muted">Postal 服务器</label>
                <input id="postal.server" class="input" type="text" placeholder="https://postal.yourdomain.com" />
              </div>
              <div class="row">
                <label class="muted">API Key</label>
                <input id="postal.key" class="input" type="password" placeholder="xxxxxxxx" />
              </div>
              <div class="row">
                <label class="muted">发件人名称</label>
                <input id="postal.from_name" class="input" type="text" placeholder="Your Name" />
              </div>
              <div class="row">
                <label class="muted">发件邮箱</label>
                <input id="postal.from_email" class="input" type="email" placeholder="you@domain.com" />
              </div>
            </section>

            <section>
              <div class="section-title">
                <h3 style="margin:0">主题（最多 5 个，轮询）</h3>
              </div>
              <div class="subjects">
                <input id="setting.subject1" class="input" placeholder="主题 1" />
                <input id="setting.subject2" class="input" placeholder="主题 2" />
                <input id="setting.subject3" class="input" placeholder="主题 3" />
                <input id="setting.subject4" class="input" placeholder="主题 4" />
                <input id="setting.subject5" class="input" placeholder="主题 5" />
              </div>
              <div class="row" style="margin-top:10px;">
                <label class="muted">限制每小时条数</label>
                <input id="setting.per_hour_limit" class="input" type="number" placeholder="例如 0=不限 或 600" />
              </div>
              <div class="row">
                <label class="muted">代理（可选）</label>
                <input id="setting.proxy" class="input" type="text" placeholder="http://127.0.0.1:7890" />
              </div>
            </section>
          </div>

          <div class="card" id="card-send">
            <h3>粘贴收件人并发送</h3>
            <section>
              <div class="row" style="grid-template-columns:1fr;">
                <textarea id="recipients_text" class="textarea" placeholder="a@example.com\nb@example.com\nc@example.com"></textarea>
              </div>
              <div class="row" style="grid-template-columns:160px 1fr;">
                <label class="muted" for="dedupe">去重</label>
                <input id="dedupe" type="checkbox" checked />
              </div>
            </section>
            <section>
              <div class="row">
                <label class="muted">主题覆盖（留空轮询）</label>
                <input id="subject_override" class="input" type="text" placeholder="本次统一主题，可留空" />
              </div>
              <div class="row">
                <label class="muted">邮件内容（HTML）</label>
                <textarea id="body_html" class="textarea" placeholder="<p>您好...</p>\n<!-- 支持 {{email}} / {{index}} / {{domain}} -->"></textarea>
              </div>
            </section>
            <section>
              <div class="toolbar">
                <button id="sendList" class="btn btn-primary" type="button">发送本次列表</button>
                <button id="saveOnly" class="btn btn-ghost" type="button">仅保存</button>
                <button id="sendAll" class="btn btn-success" type="button">发送已累积</button>
              </div>
            </section>
          </div>
        </div>

        <!-- 右列：结果 / 进度 / 收件人 / 原始配置 -->
        <div class="stack">
          <div class="card" id="card-estimate">
            <h3>发送时间预估</h3>
            <section>
              <div class="row">
                <label class="muted" for="manual_recipient_count">收件人数（可选）</label>
                <input id="manual_recipient_count" class="input" type="number" placeholder="留空则自动统计（粘贴框或已累积）" />
              </div>
              <div id="estimate_panel" class="estimator" aria-live="polite">
                <div class="est-row"><span class="est-key">当前时间：</span><span id="estNow" class="est-val">—</span></div>
                <div class="est-row"><span class="est-key">预计耗时：</span><span id="estDuration" class="est-val">—</span> <span class="est-hint">（每小时 <span id="estRate">—</span> 条，收件人 <span id="estCount">—</span> 个）</span></div>
                <div class="est-row"><span class="est-key">预计完成：</span><span id="estEnd" class="est-val">—</span></div>
              </div>
            </section>
          </div>
          <div class="card" id="card-progress">
            <h3>发送进度</h3>
            <div class="progress"><div id="progBar" class="bar"></div></div>
            <div id="progText" class="muted" style="margin-top:10px;">状态：idle</div>
            <div class="toolbar" style="margin-top:10px;">
              <button id="forceStop" class="btn btn-danger" type="button">强制停止</button>
            </div>
          </div>
          <div class="card" id="card-recipients">
            <h3>收件人列表 <span class="badge" id="recTotal">0</span></h3>
            <div class="toolbar" style="margin-bottom:8px;">
              <button id="expRec" class="btn btn-ghost" type="button">导出</button>
              <button id="clearRec" class="btn btn-danger" type="button">清空</button>
            </div>
            <pre id="recPreview" style="max-height:220px;"></pre>
          </div>
          <div class="card" id="card-config-json">
            <h3>原始配置 JSON</h3>
            <details open>
              <summary class="muted" style="cursor:pointer;">折叠/展开</summary>
              <pre id="config" style="margin-top:12px; max-height:260px;"></pre>
            </details>
          </div>
          <div class="footer-note">Mailer UI · 简化批量发送流程</div>
        </div>
      </div>
    </div>

    <script src="/static/main.js?v=20251117"></script>
  </body>
 </html>
