<!doctype html>
<html lang="zh-cn">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Mailer 配置管理</title>
  </head>
  <body>
    <h2>Mailer 配置管理</h2>
    <div>
      <h3>编辑配置</h3>
      <form id="cfgForm" onsubmit="return false;" style="max-width: 700px;">
        <fieldset>
          <legend>Postal</legend>
          <label>
            面板地址(server):
            <input id="postal.server" type="text" placeholder="https://your-postal" style="width:100%" />
          </label>
          <br/>
          <label>
            API Key:
            <input id="postal.key" type="password" placeholder="API Key" style="width:100%" />
          </label>
        <fieldset>
          <legend>Setting</legend>
          <div>
            <div style="margin-bottom:6px;">主题（最多 5 个，发送时轮询使用）</div>
            <label>主题1：<input id="setting.subject1" type="text" style="width:100%" /></label>
            <label>主题2：<input id="setting.subject2" type="text" style="width:100%" /></label>
            <label>主题3：<input id="setting.subject3" type="text" style="width:100%" /></label>
            <label>主题4：<input id="setting.subject4" type="text" style="width:100%" /></label>
            <label>主题5：<input id="setting.subject5" type="text" style="width:100%" /></label>
          </div>
          <br/>
          <label>
            代理(proxy):
            <input id="setting.proxy" type="text" placeholder="http://ip:port" style="width:100%" />
          </label>
        </fieldset>

        <div style="margin-top:10px;">
          <button id="save">保存配置</button>
          <button id="refresh" type="button">刷新配置</button>
          <span id="saveMsg" style="margin-left:10px;color:green;"></span>
        </div>
      </form>
    </div>

    <div>
      <h3>发送结果</h3>
      <button id="last">获取上次结果</button>
      <pre id="result"></pre>
    </div>

    <hr/>
    <div>
      <h3>粘贴收件人列表发送（支持去重）</h3>
      <div style="max-width: 800px;">
        <label>
          收件人（换行/逗号/分号分隔）
          <textarea id="recipients_text" rows="8" style="width:100%;" placeholder="a@example.com\nb@example.com\nc@example.com"></textarea>
        </label>
        <div style="margin:6px 0;">
          <label><input id="dedupe" type="checkbox" checked /> 去重</label>
        </div>
        <label>
          主题（留空则使用配置中的 subject）
          <input id="subject_override" type="text" style="width:100%;" />
        </label>
        <label>
          邮件内容（HTML）
          <textarea id="body_html" rows="10" style="width:100%;" placeholder="<p>您好...</p>"></textarea>
          <small>支持占位：{{email}}、{{index}}、{{domain}}</small>
        </label>
        <div style="margin-top:8px;">
          <button id="sendList">发送粘贴列表（后台）</button>
          <button id="saveOnly" type="button">仅保存不发送</button>
          <button id="sendAll" type="button">对已累积收件人发送</button>
        </div>
      </div>
    </div>

    <hr/>
    <div>
      <h3>收件人列表（recipients.txt）</h3>
      <div>
        <span>总数：<b id="recTotal">0</b></span>
        <button id="expRec">导出</button>
        <button id="clearRec">清空</button>
      </div>
      <pre id="recPreview" style="max-height: 200px; overflow:auto; background:#f7f7f7; padding:8px;"></pre>
    </div>

    <hr/>
    <div>
      <h3>发送进度</h3>
      <div style="width:100%;max-width:600px;background:#eee;height:16px;border-radius:8px;overflow:hidden;">
        <div id="progBar" style="width:0%;height:100%;background:#4caf50;"></div>
      </div>
      <div id="progText" style="margin-top:6px;color:#333;">状态：idle</div>
    </div>
    <details>
      <summary>查看原始配置 JSON</summary>
      <pre id="config">加载中...</pre>
    </details>

    <script src="/static/main.js"></script>
  </body>
</html>
